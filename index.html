<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Voice Recording Interface</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#000000" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Voice Recorder" />
    <meta name="format-detection" content="telephone=no" />
  </head>
  <body>
    <div class="container">
      <div class="single-question-container">
        <div class="question-and-skip-container">
          <div class="question-display">
            <h2 id="current-question">Loading question...</h2>
          </div>
          <button class="skip-btn" id="skip-question-btn" title="Skip Question">
            <span class="skip-text">Skip Question</span>
            <span class="skip-arrow">â†’</span>
          </button>
        </div>

        <button class="record-btn" id="main-record-btn">
          <span class="btn-text">Tap to Record Your Response</span>
          <span class="recording-indicator"></span>
        </button>
      </div>
    </div>

    <!-- Recording Confirmation Modal -->
    <div id="recording-confirmation-modal" class="modal">
      <div class="modal-content">
        <h3>Voice Recording Consent</h3>
        <p>
          Are you sure you want to record your voice response? Your recording
          will be stored securely for research purposes.
        </p>
        <div class="modal-buttons">
          <button id="confirm-recording" class="consent-btn">
            Yes, Record
          </button>
          <button id="cancel-recording" class="consent-btn">Cancel</button>
        </div>
      </div>
    </div>

    <!-- GDPR Consent Modal -->
    <div id="gdpr-modal" class="modal">
      <div class="modal-content">
        <h3>Data Collection Consent</h3>
        <p>
          Your voice recording will be stored securely on Microsoft OneDrive for
          research purposes. You can request deletion at any time by contacting
          us.
        </p>
        <div class="modal-buttons">
          <button id="consent-yes" class="consent-btn">I Consent</button>
          <button id="consent-no" class="consent-btn">Decline</button>
        </div>
      </div>
    </div>

    <!-- Recording Status -->
    <div id="status-display" class="status-hidden">
      <div class="status-content">
        <div class="pulse-animation"></div>
        <p id="status-text">Ready to record...</p>
      </div>
    </div>

    <!-- Version Display -->
    <div id="version-display">
      <span id="version-text">v2.3.0</span>
    </div>

    <!-- Microsoft Graph SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@azure/msal-browser@2.38.3/lib/msal-browser.min.js"></script>
    <script src="config.js"></script>
    <script src="script.js"></script>
    <script>
      // --- GitHub Commit Info Display ---
      (function () {
        const username = "uselessnesses"; // CHANGE to your GitHub username
        const repo = "authenticity-unmasked"; // CHANGE to your repo name
        const branch = "main";
        const versionDisplay = document.getElementById("version-display");
        const versionText = document.getElementById("version-text");
        if (!versionDisplay || !versionText) return;

        fetch(
          `https://api.github.com/repos/${username}/${repo}/commits/${branch}`
        )
          .then((res) => res.json())
          .then((data) => {
            if (data && data.sha && data.commit && data.commit.message) {
              const shortSha = data.sha.substring(0, 7);
              const msg = data.commit.message.split("\n")[0];
              versionText.textContent = `v${
                window.AZURE_CONFIG?.VERSION || ""
              } (${shortSha})`;
              const msgDiv = document.createElement("div");
              msgDiv.style.fontSize = "0.75em";
              msgDiv.style.opacity = "0.8";
              msgDiv.textContent = msg;
              versionDisplay.appendChild(msgDiv);
            }
          })
          .catch(() => {});
      })();
    </script>
  </body>
</html>
